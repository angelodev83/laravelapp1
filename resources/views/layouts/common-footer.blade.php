<!-- Bootstrap JS -->
	<script src="/assets/js/bootstrap.bundle.min.js"></script>
	<!--plugins-->
	<script src="/assets/js/jquery.min.js"></script>
	<script src="/assets/plugins/simplebar/js/simplebar.min.js"></script>
	<script src="/assets/plugins/metismenu/js/metisMenu.min.js"></script>
	<script src="/assets/plugins/perfect-scrollbar/js/perfect-scrollbar.js"></script>
	<script src="/assets/plugins/vectormap/jquery-jvectormap-2.0.2.min.js"></script>
	<script src="/assets/plugins/vectormap/jquery-jvectormap-world-mill-en.js"></script>
	<script src="/assets/plugins/highcharts/js/highcharts.js"></script>
	<script src="/assets/plugins/highcharts/js/exporting.js"></script>
	<script src="/assets/plugins/highcharts/js/variable-pie.js"></script>
	<script src="/assets/plugins/highcharts/js/export-data.js"></script>
	<script src="/assets/plugins/highcharts/js/accessibility.js"></script>
	<script src="/assets/plugins/apexcharts-bundle/js/apexcharts.min.js"></script>
	{{-- <script src="/assets/plugins/apexcharts-bundle/js/apex-custom.js"></script> --}}
	
	<!--app JS-->
	<script src="/assets/js/app.js"></script>

	<!-- DataTable -->
	<script src="/assets/plugins/datatable/js/jquery.dataTables.min.js"></script>
	<script src="https://cdnjs.cloudflare.com/ajax/libs/datatables-buttons/2.4.2/js/dataTables.buttons.min.js" integrity="sha512-ARfw9ACvbrDslvZAGzkJwl1iaFoGg61e7fTzoje0hovrNjnkeFWXjyhdxPz+39KaibFnqsMJqjtSal3vXra5GQ==" crossorigin="anonymous" referrerpolicy="no-referrer"></script>
	<script src="https://cdnjs.cloudflare.com/ajax/libs/datatables-buttons/2.4.2/js/buttons.print.min.js" integrity="sha512-8ZglfBJS5iJoRtzAJHcGquQk6e99kCUENFwbTijONUtnZkE3THiq3Nr6OMfz71tmu4Gx6jw0CG5SduBQyg57vg==" crossorigin="anonymous" referrerpolicy="no-referrer"></script>
	<script src="https://cdnjs.cloudflare.com/ajax/libs/datatables-buttons/2.4.2/js/buttons.html5.min.js" integrity="sha512-RvfP4FGRLhK9ZZjvGrGibZOC1r5jBhKTZMFUKGOv6r3tUP/mTPS7gyPl9t4LB+spY14tjUeAxOsYMBvNT2ayOw==" crossorigin="anonymous" referrerpolicy="no-referrer"></script>
	<script src="https://cdnjs.cloudflare.com/ajax/libs/datatables-buttons/2.4.2/js/buttons.colVis.min.js" integrity="sha512-uNnGMlzP0D6PEy6m0iF6UHsZ+xlOkO2wc+kMN7LMLWVym6fCQzD8tntcoS0VnaMcpRQhPhrnrMY9jMkxAkCzkQ==" crossorigin="anonymous" referrerpolicy="no-referrer"></script>


	<script src="/assets/plugins/datatable/js/dataTables.bootstrap5.js"></script>
	<script src="/assets/plugins/datatable/dataTables.responsive.min.js"></script>

	<!-- Select2 -->
	<link href="https://cdnjs.cloudflare.com/ajax/libs/select2/4.0.13/css/select2.min.css" rel="stylesheet" />
	<link href="https://cdnjs.cloudflare.com/ajax/libs/select2-bootstrap-5-theme/1.3.0/select2-bootstrap-5-theme.rtl.min.css" rel="stylesheet" />
	<script src="https://cdnjs.cloudflare.com/ajax/libs/select2/4.0.13/js/select2.min.js"></script>
	<script src="https://cdnjs.cloudflare.com/ajax/libs/select2/4.0.13/js/i18n/he.min.js"></script>

	<!-- For Date Picker jQuery UI CSS JS-->
	<link rel="stylesheet" type="text/css" href="https://cdnjs.cloudflare.com/ajax/libs/jqueryui/1.12.1/jquery-ui.min.css">
	<script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/jqueryui/1.12.1/jquery-ui.min.js"></script>

	<!-- Bootstrap DatePicker -->
	<script src="https://cdnjs.cloudflare.com/ajax/libs/bootstrap-datepicker/1.2.0/js/bootstrap-datepicker.min.js"></script>
	<link href="https://cdnjs.cloudflare.com/ajax/libs/bootstrap-datepicker/1.2.0/css/datepicker.min.css" rel="stylesheet">
	
	<!-- Tempus Dominus DateTimePicker -->
	<script src="https://cdn.jsdelivr.net/npm/@popperjs/core@2.11.6/dist/umd/popper.min.js" integrity="sha256-BRqBN7dYgABqtY9Hd4ynE+1slnEw+roEPFzQ7TRRfcg=" crossorigin="anonymous"></script>
	<script src="https://cdn.jsdelivr.net/npm/@eonasdan/tempus-dominus@6.9.4/dist/js/tempus-dominus.min.js" crossorigin="anonymous"></script>
	<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@eonasdan/tempus-dominus@6.9.4/dist/css/tempus-dominus.min.css" crossorigin="anonymous">

    <!-- Fancy File Upload -->
    <script src="/assets/plugins/fancy-file-uploader/jquery.ui.widget.js"></script>
	<script src="/assets/plugins/fancy-file-uploader/jquery.fileupload.js"></script>
	<script src="/assets/plugins/fancy-file-uploader/jquery.iframe-transport.js"></script>
	<script src="/assets/plugins/fancy-file-uploader/jquery.fancy-fileupload.js"></script>
    <script src="/assets/plugins/Drag-And-Drop/dist/imageuploadify.min.js"></script>

    <!-- Calendar Table -->
    <script src="/assets/plugins/fullcalendar/js/main.min.js"></script>

    <!-- Signature Pad -->
    {{-- <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery-signature/1.2.2/jquery.signature.min.js"></script> --}}
    <script type="text/javascript" src="/assets/plugins/keith-wood/js/jquery.signature.js"></script>

    <!--wysiwyg tinymce-->
    <script type="text/javascript" src="/assets/plugins/tinymce/tinymce.min.js" referrerpolicy="origin"></script>

	<style>
		.datepicker{
			padding: 0.375rem 0.75rem;
			border-radius: var(--bs-border-radius);
			border: var(--bs-border-width) solid var(--bs-border-color);
		}
		.select2-container--bootstrap-5 .select2-selection--single{
			background-position: right .75rem center;
			border-radius: var(--bs-border-radius);
			border: var(--bs-border-width) solid var(--bs-border-color);
		}
		.select2-container--bootstrap-5 .select2-selection--single .select2-selection__rendered {
			margin-left: -1.5em;
		}
		
	</style>

    <script>
        $(document).ready(function() {
            $('.imageuploadify-file-general-class').imageuploadify();
            
        // Toggle chatbox visibility when clicking on the header
            $('#chat-header').click(function() {
                $('#chat-body').toggle();
                $('#chat-input').toggle();
            });

            // Toggle minimize button icon
            $('#minimize-btn').click(function() {
                $(this).find('i').toggleClass('bi-dash-lg bi-plus-lg');
            });

            loadAllUnreadAnnouncementNotifications();
        });

        function openAIChatBox() {
            document.getElementById("ai-chatbox-popup").style.display = "block";
        }

        function closeAIChatBox() {
            document.getElementById("ai-chatbox-popup").style.display = "none";
        }
        
        function decodeHtmlEntities(encodedString) {
            var textarea = document.createElement("textarea");
            textarea.innerHTML = encodedString;
            return textarea.value;
        }

        function fileUtil(ext = 'default', style = 'icon')
        {
            let styles = {
                jpg: {
                    icon: 'bx-image',
                    class: 'text-danger'
                },
                jpeg: {
                    icon: 'bx-image',
                    class: 'text-danger'
                },
                png: {
                    icon: 'bx-image',
                    class: 'text-primary'
                },
                svg: {
                    icon: 'bx-image',
                    class: 'text-warning'
                },
                mp3: {
                    icon: 'bx-music',
                    class: 'text-primary'
                },
                mp4: {
                    icon: 'bxs-video',
                    class: 'text-success'
                },
                pdf: {
                    icon: 'bxs-file-pdf',
                    class: 'text-danger'
                },
                doc: {
                    icon: 'bxs-file',
                    class: 'text-primary'
                },
                docx: {
                    icon: 'bxs-file',
                    class: 'text-primary'
                },
                txt: {
                    icon: 'bx-notepad',
                    class: 'text-primary'
                },
                csv: {
                    icon: 'bxs-file-doc',
                    class: 'text-success'
                },
                xlsx: {
                    icon: 'bxs-file-doc',
                    class: 'text-success'
                },
                default: {
                    icon: 'bx-file-blank',
                    class: 'text-primary'
                }
            };

            ext = ext.toLowerCase();
            if(styles.hasOwnProperty(ext)) {
                return styles[ext][style];
            } else {
                return styles['default'][style]
            }
            return '';
        }

        function formatDateTimeBase(dateString)
        {
            // Parse the date string into a Date object
            let date = new Date(dateString);

            // Format the date components
            let formattedDate = date.toLocaleDateString('en-GL', { month: 'short', day: '2-digit', year: 'numeric', timeZone: 'UTC'});

            // Format the time components
            let formattedTime = date.toLocaleTimeString('en-GL', { hour: 'numeric', minute: '2-digit', hour12: true });

            return {
                date: formattedDate,
                time: formattedTime,
                datetime: `${formattedDate} ${formattedTime}`
            };
        }

        function formatDate(dateString)
        {
            return formatDateTimeBase(dateString).date;
        }

        function formatTime(dateString)
        {
            return formatDateTimeBase(dateString).time;
        }

        function formatDateTime(dateString)
        {
            return formatDateTimeBase(dateString).datetime;
        }

        function loadAllUnreadAnnouncementNotifications()
        {
            $.ajax({
                headers: {'X-CSRF-TOKEN': $('meta[name="csrf-token"]').attr('content')},
                type: "GET",
                url: "/admin/unread-announcements",
                contentType: "application/json; charset=utf-8",
                dataType: "json",
                success: function(res) {    
                    var data = res.data;
                    var count = res.count;
                    if(count > 0) {
                        $('#common-header-bell-notification').html(`
                            <i class='fa fa-bell fa-sm ms-2'></i>
                            <span class="alert-count">${count}</span>
                        `);
                    }
                    let bgclass = 'primary';
                    let store = '';
                    $('#common-header-bell-notificaion-list').empty();
                    $.each(data, function(index, list) {
                        if(list.type == 'store') {
                            bgclass = 'primary';
                            store = ' ('+list.pharmacy_store.code+')';
                        } else {
                            bgclass = 'info2';
                            store = '';
                        }
                        console.log("list list",list)
                        $('#common-header-bell-notificaion-list').append(`
                            <a class="dropdown-item dashboard-alert-${bgclass}" href="javascript:;" onclick="showViewAnnouncementByIdAndTypeModal('${list.type}',${list.id})">
                                <div class="d-flex align-items-center">
                                    <div class="notify bg-light-${bgclass} text-${bgclass}"><i class="bx bx-mail-send"></i>
                                    </div>
                                    <div class="flex-grow-1">
                                        <h6 class="msg-name" data-bs-toggle="tooltip" title="${list.subject}">${list.formatted_subject}
                                        </h6>
                                        <p class="msg-time">${list.formatted_pst_created_at}${store}</p>
                                    </div>
                                </div>
                            </a>
                        `); 
                    });
                },
                error: function (msg) {
                    handleErrorResponse(msg);
                }
            });
        }

        function calculateDateTimeDifference(dateTimeStr1, dateTimeStr2) {
            const date1 = new Date(dateTimeStr1.replace(' ', 'T')); // Replace space with 'T' for ISO format
            const date2 = new Date(dateTimeStr2.replace(' ', 'T')); // Replace space with 'T' for ISO format

            const differenceMs = date2 - date1; // Difference in milliseconds

            // Return difference in milliseconds
            return differenceMs;
        }

        function convertMillisecondsToTime(milliseconds) {
            // Calculate total seconds
            let totalSeconds = Math.floor(milliseconds / 1000);

            // Calculate years (assuming 365.25 days in a year on average)
            const years = Math.floor(totalSeconds / (365.25 * 24 * 60 * 60));
            totalSeconds %= (365.25 * 24 * 60 * 60); // Remaining seconds after calculating years

            // Calculate days
            const days = Math.floor(totalSeconds / (24 * 60 * 60));
            totalSeconds %= (24 * 60 * 60); // Remaining seconds after calculating days

            // Calculate hours
            const hours = Math.floor(totalSeconds / (60 * 60));
            totalSeconds %= (60 * 60); // Remaining seconds after calculating hours

            // Calculate minutes
            const minutes = Math.floor(totalSeconds / 60);

            // Remaining seconds
            const seconds = totalSeconds % 60;

            return {
                years: years,
                days: days,
                hours: hours,
                minutes: minutes,
                seconds: seconds
            };
        }

        function currentDateToYMDHMS(customDate, dateFormat = 'YYYY-MM-DD H:i:s')
        {
            let date = new Date();
            if(customDate != null && customDate != '' && customDate != undefined)
            {
                date = new Date(customDate);
            }

            let year = date.getUTCFullYear();
            let month = date.getUTCMonth() + 1;
            let day = date.getUTCDate().toString().padStart(2, '0');
            let hours = date.getUTCHours();
            let minutes = date.getUTCMinutes().toString().padStart(2, '0');
            let seconds = date.getUTCSeconds().toString().padStart(2, '0'); 

            let formattedDateTime = '';
            
            if(dateFormat == 'M d, Y H:i A') {
                month = getMonthName(month);
                hours = (hours % 12) || 12;
                const amPm = hours < 12 ? 'AM' : 'PM';
                return month + ' '+day+', '+year+' '+hours+':'+minutes+' '+amPm;
            }

            if(dateFormat == 'F d, Y H:i A') {
                month = getMonthName(month, 'F');
                hours = (hours % 12) || 12;
                const amPm = hours < 12 ? 'AM' : 'PM';
                return month + ' '+day+', '+year+' '+hours+':'+minutes+' '+amPm;
            }

            hours = hours.toString().padStart(2, '0');
            month = month.toString().padStart(2, '0'); // Month is zero-indexed
            formattedDateTime = `${year}-${month}-${day} ${hours}:${minutes}:${seconds}`;
            return formattedDateTime;
        }

        function getMonthName(number = 1, format = 'M')
        {
            number = number*1;
            number -=1;
            let months = [
                'January',
                'February',
                'March',
                'April',
                'May',
                'June',
                'July',
                'August',
                'September',
                'October',
                'November',
                'December'
            ];
            if(format == 'M') {
                return months[number].substr(0,3);
            }
            return months[number];
        }

        function getLastStringBySlash(str) {
            // Find the index of the last slash
            var lastIndex = str.lastIndexOf('/');
            
            // Check if a slash was found
            if (lastIndex !== -1) {
                // Extract the substring starting from the index after the last slash
                var lastString = str.substring(lastIndex + 1);
                return lastString;
            } else {
                // If no slash was found, return the original string
                return str;
            }
        }

        function clickOpenDocument(event, id, path)
        {
            event.preventDefault();
            window.open(path, "_blank");
        }

        function clickDownloadDocument(event, id, path)
        {
            event.preventDefault();
            var filePath = path;
            
            // Create a temporary link element
            var link = $("<a></a>");
            link.attr("href", filePath);
            
            // Set the download attribute to force download
            link.attr("download", filePath.split("/").pop());
            
            // Append the link to the document body
            $("body").append(link);
            
            // Programmatically click on the link to trigger the download
            link[0].click();
            
            // Remove the link from the document body
            link.remove();
        }

        function reloadPageWithParams(paramsObject) {
            // Get the current URL
            let currentUrl = window.location.href;

            // Construct the new URL with additional query parameters
            let newUrl = new URL(currentUrl);

            // Append additional parameters to the URL
            Object.keys(paramsObject).forEach(key => {
                newUrl.searchParams.set(key, paramsObject[key]);
            });

            // Reload the page with the updated URL
            window.location.href = newUrl.toString();
        }

        function getUrlParamValue(paramName) {
            // Create a URLSearchParams object based on the current URL
            const urlParams = new URLSearchParams(window.location.search);

            // Use the get() method to retrieve the value of the specified parameter
            return urlParams.get(paramName);
        }

        function getFirstLettersBySeparator(str, separator) {
            return str.split(separator).map(word => word[0]).join('');
        }

        function getTaskStatusDropDownUl(_dropdown_id, _dropdown_ul_id, _status_id, _category) {
            const data = {category: _category};
            $.ajax({
                headers: {'X-CSRF-TOKEN': $('meta[name="csrf-token"]').attr('content')},
                type: "POST",
                url: "/store/status/search",
                data: JSON.stringify(data),
                contentType: "application/json; charset=utf-8",
                dataType: "json",
                success: function(data) {
                
                    var len = data.length;
                    
                    $(`${_dropdown_ul_id}`).empty();
                    
                    for( var k = 0; k<len; k++){
                        var kid = data[k]['id'];
                        var kname = data[k]['name'];
                        var kcolor = data[k]['color'];
                        var kclass = data[k]['class'];
                        if(kid==_status_id){
                            const statusDropDownId = $(`${_dropdown_id}`);
                            statusDropDownId.removeClass('btn-secondary btn-primary btn-info2 btn-warning btn-danger btn-success');
                            statusDropDownId.addClass(`btn-${kclass}`);
                            statusDropDownId.html(`<i class="fa fa-circle ms-2 me-3"></i>${kname}`);
                            $(`${_dropdown_ul_id}`).append(`
                                <li>
                                    <a class="dropdown-item" href="javascript:;" onclick="changeTaskSelectedStatus(event, ${kid})">
                                        <div class="task-container d-flex">
                                            <div class="task-circle-container me-3" style="border: 1px solid ${kcolor};">
                                                <div class="task-circle" style="background-color: ${kcolor};">
                                                </div>
                                            </div>
                                            <span><b>${kname}</b></span>
                                            <span class="ms-auto text-success"><i class="fa fa-check-double"></i></span>
                                        </div>
                                    </a>
                                </li>
                            `);
                        } else {
                            $(`${_dropdown_ul_id}`).append(`
                                <li>
                                    <a class="dropdown-item" href="javascript:;" onclick="changeTaskSelectedStatus(event, ${kid})">
                                        <div class="task-container d-flex">
                                            <div class="task-circle-container me-3" style="border: 1px solid ${kcolor};">
                                                <div class="task-circle" style="background-color: ${kcolor};">
                                                </div>
                                            </div>
                                            ${kname}
                                        </div>
                                    </a>
                                </li>
                            `);
                        }
                    }
                },
                error: function (msg) {
                    handleErrorResponse(msg);
                }
            });
        }

        function getPriorityStatusDropDownUl(_dropdown_id, _dropdown_ul_id, _status_id, _category) {
            const data = {category: _category};
            $.ajax({
                headers: {'X-CSRF-TOKEN': $('meta[name="csrf-token"]').attr('content')},
                type: "POST",
                url: "/store/status/search",
                data: JSON.stringify(data),
                contentType: "application/json; charset=utf-8",
                dataType: "json",
                success: function(data) {
                
                    var len = data.length;
                    
                    $(`${_dropdown_ul_id}`).empty();
                    
                    for( var k = 0; k<len; k++){
                        var kid = data[k]['id'];
                        var kname = data[k]['name'];
                        var kcolor = data[k]['color'];
                        var kclass = data[k]['class'];
                        if(kid==_status_id){
                            const statusDropDownId = $(`${_dropdown_id}`);
                            statusDropDownId.html(`<i class="fa fa-flag text-${kclass} ms-2 me-3"></i>${kname}`);
                            $(`${_dropdown_ul_id}`).append(`
                                <li>
                                    <a class="dropdown-item" href="javascript:;" onclick="changeTaskSelectedPriorityStatus(event, ${kid})">
                                        <div class="task-container d-flex">
                                            <span>
                                                <i class="fa fa-flag text-${kclass} me-3"></i>
                                                <b>${kname}</b>
                                            </span>
                                            <span class="ms-auto text-success"><i class="fa fa-check-double"></i></span>
                                        </div>
                                    </a>
                                </li>
                            `);
                        } else {
                            $(`${_dropdown_ul_id}`).append(`
                                <li>
                                    <a class="dropdown-item" href="javascript:;" onclick="changeTaskSelectedPriorityStatus(event, ${kid})">
                                        <div class="task-container d-flex">
                                            <i class="fa fa-flag text-${kclass} me-3"></i>
                                            ${kname}
                                        </div>
                                    </a>
                                </li>
                            `);
                        }
                    }
                },
                error: function (msg) {
                    handleErrorResponse(msg);
                }
            });
        }

        function copyText(value = '', _selector)
        {
            navigator.clipboard.writeText(value);
            emitCopyText(value, _selector);
        }

        function handleErrorResponse(result) {
            if(result.status == 401) {
                Swal.fire({
                    position: 'center',
                    icon: 'warning',
                    title: "Session Time Out. Please Log In again.",
                    showConfirmButton: false,
                    timer: 8000
                }).then(() => {
                    window.location.reload(true);
                });
                return;
            }

            if(result.status == 403) {
                sweetAlert2('warning', "403 Forbidden: You don't have permission to do this action");
                return;
            }

            console.log('error',result)

            // Swal.fire({
            //     position: 'center',
            //     icon: 'warning',
            //     title: result.statusText,
            //     showConfirmButton: false,
            //     timer: 8000
            // });
        }


        function showViewAnnouncementByIdAndTypeModal(type, id){
            console.log("fire here type is", type, id)
            $.ajax({
                url: `/admin/view-announcement`,
                type: 'POST',
                headers: {
                    'X-CSRF-TOKEN': $('meta[name="csrf-token"]').attr('content')
                },
                data: {
                    id: id,
                    type: type
                },
                dataType: 'json',
                success:function(response){
                    var data = response.data;

                    console.log("common footer oopen show announcement", data)
                    
                    let subject = data.subject;
                    let content = data.content;
                    let created_at = data.formatted_pst_created_at;
                    let created_by = data.user.employee.firstname +' ' + data.user.employee.lastname;

                    var footer = `
                        <p>Created by: <b>${created_by}</b></p>
                        <p class="ms-auto">${created_at}</p>
                    `;

                    $('#show_view_announcement_modal #show_announcement_subject').html(subject);
                    $('#show_view_announcement_modal #show_announcement_body').html(content);
                    $('#show_view_announcement_modal #show_announcement_footer').html(footer);

                    // tagAsReadBulletinAnnouncement(id)

                    $('#show_view_announcement_modal').modal('show');

                },
                error: function(msg) {
                    handleErrorResponse(msg);
                }
            });
        }

        function getDaysDifference(date1, date2) {
            var diffTime = Math.abs(date2 - date1);
            var diffDays = Math.ceil(diffTime / (1000 * 60 * 60 * 24));
            return diffDays;
        }

        // Function to convert a date to PST and format it as YYYY-MM-DD
        function convertToPSTAndFormat(date) {
            // Use the Intl.DateTimeFormat API to get the date in PST
            var options = {
                timeZone: 'America/Los_Angeles',
                year: 'numeric',
                month: '2-digit',
                day: '2-digit'
            };
            var formatter = new Intl.DateTimeFormat('en-US', options);
            var parts = formatter.formatToParts(date);
            var formattedDate = parts.map(part => part.value).join('');
            // Convert MM/DD/YYYY to YYYY-MM-DD
            return formattedDate.slice(6) + '-' + formattedDate.slice(0, 2) + '-' + formattedDate.slice(3, 5);
        }

        

    </script>
	@yield('pages_specific_scripts')
</body>
